@model VaultSummaryViewModel
@{
    ViewData["Title"] = "Vault Summary";

    // Pagination window config (how many page links to show at a time)
    const int pageWindowSize = 5;

    int current = Model.CurrentPage;
    int first = Model.FirstPage ?? current;
    int last = Model.LastPage ?? current;

    // Compute window [start..end] around current page, clamped to [first..last]
    int half = pageWindowSize / 2;
    int start = current - half;
    int end = current + half;

    if (start < first)
    {
        end += (first - start);
        start = first;
    }
    if (end > last)
    {
        int diff = end - last;
        start = Math.Max(first, start - diff);
        end = last;
    }
}

<section class="container py-4">
    <!-- Top links -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex gap-3">
            <a asp-controller="Alerts" asp-action="Details" class="link-secondary">
                ← Return to alert
            </a>
            <a asp-controller="Orders" asp-action="Calculated" class="link-secondary">
                ← Return to calculated orders
            </a>
        </div>

        <!-- Optional info about page / id -->
        <div class="text-muted small">
            Vendor Balance ID: @Model.VendorBalanceId
        </div>
    </div>

    <!-- Heading -->
    <div class="mb-3">
        <h1 class="h5 mb-1">Vault summary</h1>
        <div class="small text-muted">
            Read-only view of vault balances and movements.
        </div>
    </div>

    <!-- Summary card -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <!-- Left column -->
                <div class="col-md-6">
                    <dl class="row mb-0">
                        <dt class="col-5 col-sm-4 text-muted">Vendor Balance ID</dt>
                        <dd class="col-7 col-sm-8">@Model.VendorBalanceId</dd>

                        <dt class="col-5 col-sm-4 text-muted">Transport</dt>
                        <dd class="col-7 col-sm-8">
                            @if (Model.TransportVendorId.HasValue)
                            {
                                <a asp-controller="Vendors"
                                   asp-action="Details"
                                   asp-route-id="@Model.TransportVendorId"
                                   class="link-primary">
                                    @Model.TransportVendorName
                                </a>
                            }
                            else
                            {
                                @Model.TransportVendorName
                            }
                        </dd>

                        <dt class="col-5 col-sm-4 text-muted">Balance date</dt>
                        <dd class="col-7 col-sm-8">@Model.BalanceDate.ToString("yyyy-MM-dd")</dd>

                        <dt class="col-5 col-sm-4 text-muted">Currency</dt>
                        <dd class="col-7 col-sm-8">@Model.Currency</dd>

                        <dt class="col-5 col-sm-4 text-muted">Prepared by</dt>
                        <dd class="col-7 col-sm-8">@Model.PreparedBy</dd>

                        <dt class="col-5 col-sm-4 text-muted">Completed date</dt>
                        <dd class="col-7 col-sm-8">
                            @(Model.CompletedDate.HasValue
                                ? Model.CompletedDate.Value.ToString("yyyy-MM-dd HH:mm")
                                : "-")
                        </dd>
                    </dl>
                </div>

                <!-- Right column: Amounts -->
                <div class="col-md-6">
                    <dl class="row mb-0">
                        <dt class="col-7 col-sm-6 text-muted">Bulk In</dt>
                        <dd class="col-5 col-sm-6 text-end">@Model.BulkIn.ToString("C")</dd>

                        <dt class="col-7 col-sm-6 text-muted">Bulk Out</dt>
                        <dd class="col-5 col-sm-6 text-end">@Model.BulkOut.ToString("C")</dd>

                        <dt class="col-7 col-sm-6 text-muted">Ending balance</dt>
                        <dd class="col-5 col-sm-6 text-end fw-semibold">@Model.EndingBalance.ToString("C")</dd>

                        <dt class="col-7 col-sm-6 text-muted">Emergency</dt>
                        <dd class="col-5 col-sm-6 text-end">@Model.Emergency.ToString("C")</dd>

                        <dt class="col-7 col-sm-6 text-muted">Bagged for next</dt>
                        <dd class="col-5 col-sm-6 text-end">@Model.BaggedForNext.ToString("C")</dd>

                        <dt class="col-7 col-sm-6 text-muted">Bagged for remote</dt>
                        <dd class="col-5 col-sm-6 text-end">@Model.BaggedForRemote.ToString("C")</dd>

                        <dt class="col-7 col-sm-6 text-muted">Closing amount</dt>
                        <dd class="col-5 col-sm-6 text-end fw-semibold">@Model.ClosingAmount.ToString("C")</dd>
                    </dl>
                </div>
            </div>

            <!-- Comments -->
            <div class="mt-3">
                <label class="form-label fw-semibold mb-1">Comments</label>
                <div class="form-control-plaintext border rounded px-3 py-2 bg-light-subtle">
                    @(string.IsNullOrWhiteSpace(Model.Comments) ? "No comments." : Model.Comments)
                </div>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    @if (Model.FirstPage.HasValue && Model.LastPage.HasValue && Model.FirstPage != Model.LastPage)
    {
        <nav aria-label="Vault summaries pages">
            <ul class="pagination pagination-sm justify-content-center">

                <!-- First -->
                <li class="page-item @(Model.FirstPage == null || Model.CurrentPage == Model.FirstPage ? "disabled" : "")">
                    @if (Model.FirstPage != null && Model.CurrentPage != Model.FirstPage)
                    {
                        <a class="page-link"
                           asp-route-page="@Model.FirstPage">
                            « First
                        </a>
                    }
                    else
                    {
                        <span class="page-link">« First</span>
                    }
                </li>

                <!-- Previous -->
                <li class="page-item @(Model.PreviousPage == null ? "disabled" : "")">
                    @if (Model.PreviousPage != null)
                    {
                        <a class="page-link"
                           asp-route-page="@Model.PreviousPage">
                            ‹ Prev
                        </a>
                    }
                    else
                    {
                        <span class="page-link">‹ Prev</span>
                    }
                </li>

                <!-- Page number window -->
                @for (var p = start; p <= end; p++)
                {
                    bool isActive = (p == Model.CurrentPage);
                    <li class="page-item @(isActive ? "active" : "")">
                        @if (isActive)
                        {
                            <span class="page-link">@p</span>
                        }
                        else
                        {
                            <a class="page-link" asp-route-page="@p">@p</a>
                        }
                    </li>
                }

                <!-- Next -->
                <li class="page-item @(Model.NextPage == null ? "disabled" : "")">
                    @if (Model.NextPage != null)
                    {
                        <a class="page-link"
                           asp-route-page="@Model.NextPage">
                            Next ›
                        </a>
                    }
                    else
                    {
                        <span class="page-link">Next ›</span>
                    }
                </li>

                <!-- Last -->
                <li class="page-item @(Model.LastPage == null || Model.CurrentPage == Model.LastPage ? "disabled" : "")">
                    @if (Model.LastPage != null && Model.CurrentPage != Model.LastPage)
                    {
                        <a class="page-link"
                           asp-route-page="@Model.LastPage">
                            Last »
                        </a>
                    }
                    else
                    {
                        <span class="page-link">Last »</span>
                    }
                </li>
            </ul>
        </nav>
    }
</section>